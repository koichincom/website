---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import PageTitle from "../../components/PageTitle.astro";
import ProjectList from "../../components/ProjectList.astro";

const title = "Projects";
const metaTitle = `${title} | Koichi Nakayamada`;

const projectEntries = await getCollection("projects");
const sortProjects = (
    entries: typeof projectEntries,
): typeof projectEntries =>
    entries.sort((a, b) => {
        const pinnedDelta = Number(b.data.pinned ?? false) -
            Number(a.data.pinned ?? false);
        if (pinnedDelta !== 0) {
            return pinnedDelta;
        }
        return (
            new Date(b.data.published).getTime() -
            new Date(a.data.published).getTime()
        );
    });

const standardProjects = sortProjects(
    projectEntries.filter((project) => !project.data.hardwareBound),
);
const hardwareBoundProjects = sortProjects(
    projectEntries.filter((project) => project.data.hardwareBound),
);
---

<BaseLayout metaTitle={metaTitle}>
    <PageTitle>{title}</PageTitle>
    <div class="flex flex-col gap-20 pb-24">
        <section>
            <ProjectList projects={standardProjects} />
        </section>
        {
            hardwareBoundProjects.length ? (
                <section class="pt-6">
                    <ProjectList projects={hardwareBoundProjects} />
                </section>
            ) : null
        }
    </div>
</BaseLayout>
