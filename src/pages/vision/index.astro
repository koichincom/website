---
import { getCollection, render } from "astro:content";
import BaseLayout from "../../layouts/base.astro";
const title = "Koichi's Vision";
const h1 = "Vision";

const allVisionPosts = (await getCollection("vision")).sort(
    (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
);

// Get latest post and render its content
const latestPost = allVisionPosts[0];
const { Content } = await render(latestPost);

// Get older posts for the list
const visionPosts = allVisionPosts.slice(1);
---

<BaseLayout title={title} h1={h1}>
    <!-- Latest Vision Content -->
    <article class="prose prose-base max-w-none dark:prose-invert mb-8 sm:mb-12">
        <Content />
    </article>

    <!-- Previous Versions (only show if there are older posts) -->
    {visionPosts.length > 0 && (
        <>
            <h2 class="mb-4 text-xl sm:text-2xl font-semibold text-(--color-text-first) dark:text-(--color-text-first-dark)">
                Previous Versions
            </h2>
            <ul class="mb-4">
                {
                    visionPosts.map((post) => (
                        <li class="py-2">
                            <a href={`/vision/${post.id}`} class="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                                <span class="text-base text-(--color-text-second) dark:text-(--color-text-second-dark) hover:text-(--color-accent-light) dark:hover:text-(--color-accent-dark) transition-colors duration-200">
                                    {post.data.title}
                                </span>
                                <time class="text-sm text-(--color-text-third) dark:text-(--color-text-third-dark) mt-1 sm:mt-0" datetime={post.data.date}>
                                    {new Date(post.data.date).toLocaleDateString(undefined, {
                                        year: "numeric",
                                        month: "long",
                                        day: "numeric",
                                    })}
                                </time>
                            </a>
                        </li>
                    ))
                }
            </ul>
        </>
    )}
</BaseLayout>
