---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";

import PageTitle from "../components/PageTitle.astro";
import SectionTitle from "../components/SectionTitle.astro";
import WritingList from "../components/WritingList.astro";
import ProjectList from "../components/ProjectList.astro";
import CopyToClipboardLink from "../components/CopyToClipboardLink.astro";

const title = "Koichi Nakayamada";
const h1Title = "Technical Philanthropy";

// Fetch projects sorted by pinned and published date, take featured ones
const projects = (await getCollection("projects"))
    .filter((project) => project.data.featured)
    .sort((a, b) => {
        const pinnedDelta =
            Number(b.data.pinned ?? false) - Number(a.data.pinned ?? false);
        if (pinnedDelta !== 0) return pinnedDelta;
        return (
            new Date(b.data.published).getTime() -
            new Date(a.data.published).getTime()
        );
    });

// Fetch writing posts sorted by published date (newest first), take latest 5
const writingPosts = (await getCollection("writing"))
    .sort(
        (a, b) =>
            new Date(b.data.published).getTime() -
            new Date(a.data.published).getTime(),
    )
    .slice(0, 5);
---

<BaseLayout metaTitle={title}>
    <PageTitle>{h1Title}</PageTitle>
    <div class="flex flex-col gap-8 sm:gap-12 pb-4">
        <section>
            <p
                class="px-content-inset text-base text-(--color-text-second) dark:text-(--color-text-second-dark) leading-relaxed"
            >
                I'm a <span id="age-display"></span>-year-old Japanese <CopyToClipboardLink
                    href="https://example.com">data science</CopyToClipboardLink
                > and open-source developer, currently studying in the United States.
                I aspire to practice "technical philanthropy" which is to contribute
                to humanity through technology, driven by a genuine love for humankind.
            </p>
        </section>

        <section>
            <SectionTitle>Featured Projects</SectionTitle>
            <ProjectList projects={projects} />
        </section>

        <section>
            <SectionTitle>Latest Writing</SectionTitle>
            <WritingList posts={writingPosts} />
        </section>
    </div>

    <script>
        import { AGE } from "../scripts/age-calculator";
        const ageDisplay = document.getElementById("age-display");
        if (ageDisplay) {
            ageDisplay.textContent = AGE.toString();
        }
    </script>
</BaseLayout>
