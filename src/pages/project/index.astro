---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import ProjectList from "../../components/ProjectList.astro";
import PageTitle from "../../components/PageTitle.astro";
import SectionTitle from "../../components/SectionTitle.astro";

const title = "Projects";
const metaTitle = title;

const projectEntries = await getCollection("projects");
const sortProjects = (entries: typeof projectEntries): typeof projectEntries =>
    entries.sort((a, b) => {
        const pinnedDelta =
            Number(b.data.pinned ?? false) - Number(a.data.pinned ?? false);
        if (pinnedDelta !== 0) {
            return pinnedDelta;
        }
        return (
            new Date(b.data.published).getTime() -
            new Date(a.data.published).getTime()
        );
    });

const standardProjects = sortProjects(
    projectEntries.filter((project) => !project.data.hardwareBound),
);
const hardwareBoundProjects = sortProjects(
    projectEntries.filter((project) => project.data.hardwareBound),
);
---

<BaseLayout metaTitle={metaTitle}>
    <PageTitle>{title}</PageTitle>
    <div class="flex flex-col gap-20">
        <section>
            {
                standardProjects.length ? (
                    <ProjectList projects={standardProjects} />
                ) : null
            }
        </section>
        <section id="hardware-bound">
            <SectionTitle>Hardware-Bound</SectionTitle>
            {
                hardwareBoundProjects.length ? (
                    <ProjectList projects={hardwareBoundProjects} />
                ) : null
            }
        </section>
    </div>
</BaseLayout>
